---
title: "TCGA Data Analysis using tgcapkg"
author: "Abhishek Sinha"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{TCGA Data Analysis using tgcapkg}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
#options(rmarkdown.html_vignette.check_title = FALSE)
```

# Introduction

The Cancer Genome Atlas (TCGA) datasets are an extensive set of Cancer datasets widely used in Cancer research and clinical publications. The TCGA Research Network has cataloged different molecular information of 33 human cancer types to increase our biological insight into cancers. One major aspect of TCGA cancer research uses the gene expression data gathered from the Gene expression experiments that are conducted to better understand the biological mechanisms in cells and tissues. But Gene expression data is almost always compromised by unwanted variation that may lead to inaccurate and wrong biological results and retractions. Effective removal of unwanted variation such as batch effects is one of the main challenges of the analysis of gene expression data, particularly when the data comes from large and complex experiments.

The goal of the **_tgcapkg_** package is to minimize this challenge and help users to analyse and handle these unwanted variations. This package acts as a tool to let users account for the unwanted variations in their research and publications.

```{r setup}
library(tgcapkg)
```

# Data

```{r}
data("brca.data")
```

```{r}
brca.data
```

The package contains a highly condensed version of the original dataset with 100 unique genes and 1222 samples. The data consists three individual data that can be accessed using \code{SummarizedExperiment::assay()}. Sample meta-data describing the samples can be accessed using \code{SummarizedExperiment::colData()}, and is a DataFrame that can store any number of descriptive columns for each sample row. Similarly, Gene meta-data describing the genes can be accessed using \code{SummarizedExperiment::rowData()}, and is a DataFrame that can store any number of descriptive columns for each gene row.

```{r eval=FALSE}
gene.annot <-  as.data.frame(SummarizedExperiment::rowData(brca.data))
sample.info <-  as.data.frame(SummarizedExperiment::colData(brca.data))
raw.count <- as.data.frame(SummarizedExperiment::assay(brca.data, 'HTseq_counts'))
```
# Data Wrangling

# Gene Filter

## Filter data by specific gene.

```{r}
df1 <- gene.filter(data=brca.data,gene.type=c("protein_coding"))
```

# Removing lowly expressed genes

## Filter data for genes with low count set number of samples

```{r}
df2 <- low.genes.filter(data=df1,gene_count = 20,sample_size = 200)
```

# Purity Filter

## Filter Samples based on Tumor Purity

```{r}
df3 <- purity.filter(data= df2,purity_cutoff= 0.496)
```

# Library Size Filter

## Determine Library Size

```{r fig.align='center', fig.width=7, fig.height=5}
library.size(data = df3, plot_type = "Scatterplot")
```

## Filter samples based on library size

```{r}
df4 <- library.size.fil(data = df3, ls_cutoff = 17.5)
```

# Data Analysis

# Study Design Plot

```{r fig.align='center', fig.width=7, fig.height=5}
study.design(data = df4)
```
# PCA

## Generate PCA

```{r}
# Is data input for PCA logical
is.logical(df4)
```


```{r}
df5 <- get.pca(data = df4, nPcs = 7, is.log = FALSE)
```

```{r}
# Generated 7 PCs for first two genes
head(df5[['HTseq_counts']]$sing.val$u,2)
```

## Plot PCA

```{r fig.align='center', fig.width=7, fig.height=5, message=FALSE}
library(ggplot2)
library(cowplot)
pca.plot(pca.data = df5, data = df4, group = "Time", plot_type = "DensityPlot", npcs = 3)
```

# PCs correlation with unwanted variations

```{r fig.align='center',message=FALSE, fig.width=7, fig.height=5}
library(tidyverse)
df6 <- pca.corr(pca.data = df5, data = df4, type = "purity", nPCs = 7)
df6
```

# Gene correlation 

```{r fig.align='center', fig.width=7, fig.height=5}
df7 <- gene.corr(data = df4, is.log = FALSE, type = "librarysize", cor.method = 'spearman', n.cores = 2)
head(df7)
```

# Anova Test

```{r}
df8 <- f.test(data = df4, variable = "Time", is.log = FALSE, n.cores = 2)
head(df8)
```
# RUV - III

## PRPS Map

```{r fig.align='center', fig.width=7, fig.height=5, message=FALSE}
ruv.prps.plot(data = df4)
```

## PRPS Generation

```{r}
df9 <- get.prps(data=df4, batch=c('Year', 'Plates'), biology='biology', purity=NULL, include.ls=T, include.purity=F, n.ls.ps=10, n.sample.batch=3, n.sample.purity=0, n.sample.ls=3)
```

